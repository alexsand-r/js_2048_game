let e=new class{constructor(e){this.field=e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return!1;let e=this.field.map(e=>this.processRow(e));return!!this.hasFieldChanged(this.field,e)&&(this.field=e,this.addRandomTile(),this.updateStatus(),!0)}moveRight(){if("playing"!==this.status)return!1;let e=this.field.map(e=>this.processRow([...e].reverse()).reverse());return!!this.hasFieldChanged(this.field,e)&&(this.field=e,this.addRandomTile(),this.updateStatus(),!0)}moveUp(){if("playing"!==this.status)return!1;let e=this.transpose(this.field),t=this.transpose(e.map(e=>this.processRow(e)));return!!this.hasFieldChanged(this.field,t)&&(this.field=t,this.addRandomTile(),this.updateStatus(),!0)}moveDown(){if("playing"!==this.status)return!1;let e=this.transpose(this.field),t=this.transpose(e.map(e=>this.processRow([...e].reverse()).reverse()));return!!this.hasFieldChanged(this.field,t)&&(this.field=t,this.addRandomTile(),this.updateStatus(),!0)}getScore(){return this.score}getState(){return this.field}getStatus(){return this.status}start(){this.field=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.start()}processRow(e){let t=e.filter(e=>0!==e),s=[];for(let e=0;e<t.length;e++)if(t[e]===t[e+1]){let i=2*t[e];this.score+=i,s.push(i),e++}else s.push(t[e]);for(;s.length<4;)s.push(0);return s}addRandomTile(){let e=[];if(this.field.forEach((t,s)=>{t.forEach((t,i)=>{0===t&&e.push([s,i])})}),!e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)];this.field[t][s]=.9>Math.random()?2:4}hasFieldChanged(e,t){return JSON.stringify(e)!==JSON.stringify(t)}transpose(e){return e[0].map((t,s)=>e.map(e=>e[s]))}updateStatus(){if(this.field.flat().includes(2048)){this.status="win";return}this.movePossible(this.field)||this.movePossible(this.transpose(this.field))||(this.status="lose")}movePossible(e){return e.some(e=>e.some((t,s)=>0===t||t===e[s+1]))}},t=document.querySelectorAll(".field-cell"),s=document.querySelector(".game-score"),i=document.querySelector(".button"),r=document.querySelector(".message-start"),a=document.querySelector(".message-win"),d=document.querySelector(".message-lose");function l(){let i=e.getState(),l=e.getScore(),h=e.getStatus();t.forEach((e,t)=>{let s=i[Math.floor(t/4)][t%4];e.textContent=0===s?"":s,e.className="field-cell",0!==s&&e.classList.add(`field-cell--${s}`)}),s.textContent=l,r.classList.add("hidden"),a.classList.add("hidden"),d.classList.add("hidden"),"idle"===h&&r.classList.remove("hidden"),"win"===h&&a.classList.remove("hidden"),"lose"===h&&d.classList.remove("hidden")}i.addEventListener("click",()=>{"idle"===e.getStatus()?(e.start(),i.textContent="Restart",i.classList.remove("start"),i.classList.add("restart")):e.restart(),l()}),document.addEventListener("keydown",t=>{t.preventDefault();let s=!1;switch(t.key){case"ArrowLeft":s=e.moveLeft();break;case"ArrowRight":s=e.moveRight();break;case"ArrowUp":s=e.moveUp();break;case"ArrowDown":s=e.moveDown();break;default:return}s&&l()}),l();
//# sourceMappingURL=js_2048_game.89d091e3.js.map
